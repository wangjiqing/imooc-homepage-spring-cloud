## SpringCloud框架使用实例 —— 慕课网

### 一，导学
    
   #### 1.1. Eureka：服务治理的核心组件。是Netflix开发的服务发现框架，本身是一个基于REST的服务，主要用于定位运行在AWS域中的中间层服务，已达到负载均衡和中间件服务故障转移的目的。SpringCloud将它集成在其子项目spring-cloud-netflix中，以实现SpringCloud服务发现功能。
   #### 1.2. Zuul：Zuul是Netflix开源的一个API Gateway服务器，本质上是一个Web Servlet应用。在云平台上提供动态路由，监控，弹性，安全等边缘服务框架。Zuul相当于是设备和NetFlix流应用的Web网站后端请求的大门。
   #### 1.3. Feign：Netflix开发的声明式、模板化的HTTP客户端，Feign可以帮助我们更快速，优雅地调用HTTP API。在SpringCloud中，使用Feign非常简单——创建一个接口，并在接口上添加一些注解，代码就完成了。
   #### 1.4. Hystrix：在分布式环境中，许多服务依赖项中必然会存在失败的情况。Hystrix是一个库，通过添加延迟容忍和容错逻辑，帮助控制分布式服务之间的交互。Hystrix通过隔离服务之间的访问点，停止级联失败和提供回退选项来实现。提高服务的弹性。
 
### 二、项目环境

   #### 2.1. Java8
   #### 2.2. Maven
   #### 3.3. Spring
   #### 3.4. Spring Boot
   
### 三、SpringCloud预览

   #### 3.1. EureKa (服务发现框架)
   
    EureKa包含两个组件：Eureka Server 和 Eureka Client.
    EureKa Server提供服务注册服务，各个节点启动后，会在Eureka Server中进行注册，这样Eureka Server中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观的查看到。
    EureKa Client是一个Java客户端，用于简化与EureKa Server交互，客户端同时也就是一个内置的、使用轮询（round-robin）负载算法的负载均衡器。
    在应用启动后，会将Eureka Server发送心跳，默认周期30秒，如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，Eureka Server会将这个服务的节点从服务注册表中移除（默认90秒）。
    EureKa Server之间通过复制的方式完成数据同步，Eureka还提供了客户端缓存机制，即使所有的Eureka都挂掉，客户端依然可以利用缓存中的信息消费其它服务的API。
    综上，Eureka通过心跳检测，客户端缓存等机制，确保了系统的高可用性、灵活性和可伸缩性。
    
   #### 3.2. Zuul (Api Gateway)
    
     Zuul是一个 API Geteway 服务器，本质上是一WebServlet应用。Zuul提供了动态路由、监控等服务，这些功能实现的核心是一系列的过滤器（Filters）。
     在微服务架构中，通常会有多个服务提供者。每个服务的服务类型不同，而每个类型的服务也会随着系统体量的增大也会随之增长和变更。
     Zuul是SpringCloud全家桶中的微服务API网关。所有从设备或者网站来的请求都会经过Zuul到达后端的Netflix应用程序。作为一个边界性质的程序，Zuul提供了一个动态路由、监控、弹性负载和安全功能。Zuul底层利用各种Filter实现如下功能：
      . 认证和安全，识别每个需要认证的资源，拒绝不符合要求的请求。
      . 性能检测，在服务边界追踪并统计数据，提供精确的生产视图。
      . 动态路由，根据需要将请求你动态路由到后端集群。
      . 压力测试，逐渐增加对对群的流量以了解其性能。
      . 负载卸载，预先为每种类型的请求分配容量，当请求超过容量时自动放弃。
      . 静态资源处理，直接在边界返回某些响应。
      
   #### 3.3. Ribbon (负载均衡工具)
   
    SpringCloud Ribbon包括两部分：负载均衡算法 + app_name 转具体的 ip:port 访问地址
    SpringCloud Ribbon是一个基于HTTP和TCP的客户端负载均衡工具，它基于Netflix Ribbon实现。通过SpringCloud的封装，可以让我们轻松的将面向服务的REST模板请求自动转换成客户端负载均衡的服务调用。SpringCloud Ribbon只是一个工具类框架，需要独立部署，他几乎存在于每个SpringCloud构建的微服务和基础设施中。因为微服务间的调用，API网关的请求转发等内容，实际上都是通过Ribbon实现的，包括Feign也是基于Ribbon实现的工具。
    
   #### 3.4. Feign (声明式WebService客户端)
   
    基于Ribbon实现的声明式的web service客户端，它让微服务之间的调用变得更简单了，类似Controller调用Service，Service调用Dao。SpringCloud集成Ribbon和Eureka，可在使用Feign是提供负载均衡的HTTP客户端。
    
   #### 3.5. Hystrix (熔断器)
   
    微服务系统架构下一定会存在服务雪崩问题：系统中的蝴蝶效应导致其发生的原因多种多样，有不合理的容量设计，或者高并发的某一个方法响应变慢或者无响应，亦或者是某台机器的资源耗尽。从源头上我们无法完全杜绝雪崩源头的发生。可以知道的是雪崩问题根本问题来源于各个微服务之间的强依赖，Hystrix（熔断器）就是为了解决这个问题的。利用Hystrix可以做到熔断、隔离、限流等。
    在分布式系统环境下，许多服务依赖项中必然会存在失败。Hystrix是一个库，通过添加延迟容忍和容错逻辑，帮你程序控制这些分布式服务之间的交互。Hystrix通过隔离服务之间的访问点、停止级联失败和提供回退选项来实现这一点，所有这些都可以提供系统的整体弹性。
    Hystrix的目标是：
    1. 对通过第三方客户端库访问的依赖项（通常需要通过网络）的延迟和故障进行保护和控制。
    2. 在复杂的分布式系统中组织级联故障。
    3. 快速失败，快速恢复。
    4. 回退，尽可能的优雅的降级。
    5. 启用近实时的监控，警报和操作控制。
    Hystrix设计原则：
    1. 防止任何单个依赖项耗尽所有容器（如Tomcat）用户线程。
    2. 甩掉包袱，快速失败而不是排队。
    3. 在任何可行的地方回退，以保护用户不受失败的影响。
    4. 使用隔离技术（如隔离板、用到和断路器模式）来限制任何一个依赖项的影响。
    5. 通过近实时的监控、度量和报警来优化发现时间。
    6. 通过配置的低延迟传播来优化恢复时间。
    7. 支持对Hystrix的大多数方面的动态属性更改，允许使用低延迟反馈循环进行实时操作修改。
    8. 避免在整个依赖客户端执行中出现故障，而不仅仅是在网络流量中。
    Hystrix是如何实现的：
    1. 用一个HystrixCommand或者HystrixObservableCommand（一个命令模式的例子）包装所有的对外部系统（或者依赖）的调用，典型地他们在一个单独的线程中执行。
    2. 调用超时时间比预定义的阈值要长。有一个默认值，对于大多数的依赖项可以自定义超时时间。
    3. 为每个依赖项维护一个小的线程池（或信号量）；如果线程池满了，那么该依赖项会立即拒绝请求，而不是排队。
    4. 调用的结果有成功、失败（客户端抛出异常）、超时、拒绝。
    5. 在一段时间内，如果服务的错误百分比超过了一个阈值，就会触发一个断路器来停止对特定服务的所有请求，无论是手动的还是自动的。
    6. 当请求失败、被拒绝、超时或短路时，执行降级回退逻辑。
    7. s近实时监控指标和配置变化。
    
### 四、数据库表脚本导入即可